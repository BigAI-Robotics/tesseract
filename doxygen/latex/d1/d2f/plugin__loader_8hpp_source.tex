\hypertarget{plugin__loader_8hpp_source}{}\doxysection{plugin\+\_\+loader.\+hpp}
\label{plugin__loader_8hpp_source}\index{tesseract\_common/include/tesseract\_common/plugin\_loader.hpp@{tesseract\_common/include/tesseract\_common/plugin\_loader.hpp}}
\mbox{\hyperlink{plugin__loader_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{26 \textcolor{preprocessor}{\#ifndef TESSERACT\_COMMON\_PLUGIN\_LOADER\_HPP}}
\DoxyCodeLine{27 \textcolor{preprocessor}{\#define TESSERACT\_COMMON\_PLUGIN\_LOADER\_HPP}}
\DoxyCodeLine{28 }
\DoxyCodeLine{29 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{macros_8h}{tesseract\_common/macros.h}}>}}
\DoxyCodeLine{30 \mbox{\hyperlink{macros_8h_a8cc0e3c6a3382c5c0b19eb9e676fc2db}{TESSERACT\_COMMON\_IGNORE\_WARNINGS\_PUSH}}}
\DoxyCodeLine{31 \textcolor{preprocessor}{\#include <boost/algorithm/string.hpp>}}
\DoxyCodeLine{32 \textcolor{preprocessor}{\#include <console\_bridge/console.h>}}
\DoxyCodeLine{33 \textcolor{preprocessor}{\#include <ostream>}}
\DoxyCodeLine{34 \mbox{\hyperlink{namespaceTESSERACT__COMMON__IGNORE__WARNINGS__POP}{TESSERACT\_COMMON\_IGNORE\_WARNINGS\_POP}}}
\DoxyCodeLine{35 }
\DoxyCodeLine{36 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{plugin__loader_8h}{tesseract\_common/plugin\_loader.h}}>}}
\DoxyCodeLine{37 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{class__loader_8h}{tesseract\_common/class\_loader.h}}>}}
\DoxyCodeLine{38 }
\DoxyCodeLine{39 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacetesseract__common}{tesseract\_common}}}
\DoxyCodeLine{40 \{}
\DoxyCodeLine{41 \textcolor{keyword}{inline} std::set<std::string> \mbox{\hyperlink{namespacetesseract__common_af2c2ec207efac0e2080c6488163eb082}{parseEnvironmentVariableList}}(\textcolor{keyword}{const} std::string\& env\_variable)}
\DoxyCodeLine{42 \{}
\DoxyCodeLine{43   std::set<std::string> list;}
\DoxyCodeLine{44   \textcolor{keywordtype}{char}* env\_var = std::getenv(env\_variable.c\_str());}
\DoxyCodeLine{45   \textcolor{keywordflow}{if} (env\_var == \textcolor{keyword}{nullptr})  \textcolor{comment}{// Environment variable not found}}
\DoxyCodeLine{46     \textcolor{keywordflow}{return} list;}
\DoxyCodeLine{47 }
\DoxyCodeLine{48   std::string evn\_str = std::string(env\_var);}
\DoxyCodeLine{49   boost::split(list, evn\_str, boost::is\_any\_of(\textcolor{stringliteral}{"{}:"{}}), boost::token\_compress\_on);}
\DoxyCodeLine{50   \textcolor{keywordflow}{return} list;}
\DoxyCodeLine{51 \}}
\DoxyCodeLine{52 }
\DoxyCodeLine{53 \textcolor{keyword}{inline} std::set<std::string> \mbox{\hyperlink{namespacetesseract__common_a4d07851ebdfbd06448599d1c188a2a50}{getAllSearchPaths}}(\textcolor{keyword}{const} std::string\& search\_paths\_env,}
\DoxyCodeLine{54                                                \textcolor{keyword}{const} std::set<std::string>\& existing\_search\_paths)}
\DoxyCodeLine{55 \{}
\DoxyCodeLine{56   \textcolor{comment}{// Check for environment variable to override default library}}
\DoxyCodeLine{57   \textcolor{keywordflow}{if} (!search\_paths\_env.empty())}
\DoxyCodeLine{58   \{}
\DoxyCodeLine{59     std::set<std::string> search\_paths = \mbox{\hyperlink{namespacetesseract__common_af2c2ec207efac0e2080c6488163eb082}{parseEnvironmentVariableList}}(search\_paths\_env);}
\DoxyCodeLine{60     search\_paths.insert(existing\_search\_paths.begin(), existing\_search\_paths.end());}
\DoxyCodeLine{61     \textcolor{keywordflow}{return} search\_paths;}
\DoxyCodeLine{62   \}}
\DoxyCodeLine{63 }
\DoxyCodeLine{64   \textcolor{keywordflow}{return} existing\_search\_paths;}
\DoxyCodeLine{65 \}}
\DoxyCodeLine{66 }
\DoxyCodeLine{67 \textcolor{keyword}{inline} std::set<std::string> \mbox{\hyperlink{namespacetesseract__common_a6649a8ac1b3dcd569656074bbcfce030}{getAllSearchLibraries}}(\textcolor{keyword}{const} std::string\& search\_libraries\_env,}
\DoxyCodeLine{68                                                    \textcolor{keyword}{const} std::set<std::string>\& existing\_search\_libraries)}
\DoxyCodeLine{69 \{}
\DoxyCodeLine{70   \textcolor{comment}{// Check for environment variable to override default library}}
\DoxyCodeLine{71   \textcolor{keywordflow}{if} (!search\_libraries\_env.empty())}
\DoxyCodeLine{72   \{}
\DoxyCodeLine{73     std::set<std::string> search\_libraries = \mbox{\hyperlink{namespacetesseract__common_af2c2ec207efac0e2080c6488163eb082}{parseEnvironmentVariableList}}(search\_libraries\_env);}
\DoxyCodeLine{74     search\_libraries.insert(existing\_search\_libraries.begin(), existing\_search\_libraries.end());}
\DoxyCodeLine{75     \textcolor{keywordflow}{return} search\_libraries;}
\DoxyCodeLine{76   \}}
\DoxyCodeLine{77 }
\DoxyCodeLine{78   \textcolor{keywordflow}{return} existing\_search\_libraries;}
\DoxyCodeLine{79 \}}
\DoxyCodeLine{80 }
\DoxyCodeLine{81 \textcolor{keyword}{template} <\textcolor{keyword}{class} PluginBase>}
\DoxyCodeLine{82 std::shared\_ptr<PluginBase> \mbox{\hyperlink{classtesseract__common_1_1PluginLoader_a453681a0572061cdfdefb561c9c084f2}{PluginLoader::instantiate}}(\textcolor{keyword}{const} std::string\& plugin\_name)\textcolor{keyword}{ const}}
\DoxyCodeLine{83 \textcolor{keyword}{}\{}
\DoxyCodeLine{84   \textcolor{comment}{// Check for environment variable for plugin definitions}}
\DoxyCodeLine{85   std::set<std::string> plugins\_local = \mbox{\hyperlink{namespacetesseract__common_a6649a8ac1b3dcd569656074bbcfce030}{getAllSearchLibraries}}(\mbox{\hyperlink{classtesseract__common_1_1PluginLoader_af3929c97ee7a2ca0865c616397c1caba}{search\_libraries\_env}}, \mbox{\hyperlink{classtesseract__common_1_1PluginLoader_ac21baef3ac5e035e5d6604c48dce293c}{search\_libraries}});}
\DoxyCodeLine{86   \textcolor{keywordflow}{if} (plugins\_local.empty())}
\DoxyCodeLine{87   \{}
\DoxyCodeLine{88     CONSOLE\_BRIDGE\_logError(\textcolor{stringliteral}{"{}No plugin libraries were provided!"{}});}
\DoxyCodeLine{89     \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};}
\DoxyCodeLine{90   \}}
\DoxyCodeLine{91 }
\DoxyCodeLine{92   \textcolor{comment}{// Check for environment variable for search paths}}
\DoxyCodeLine{93   std::set<std::string> search\_paths\_local = \mbox{\hyperlink{namespacetesseract__common_a4d07851ebdfbd06448599d1c188a2a50}{getAllSearchPaths}}(\mbox{\hyperlink{classtesseract__common_1_1PluginLoader_a07ad5f9ed665a443296650ba4cf74ac2}{search\_paths\_env}}, \mbox{\hyperlink{classtesseract__common_1_1PluginLoader_a0708204dd34adfdec1a7506df07cd30a}{search\_paths}});}
\DoxyCodeLine{94   \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& path : search\_paths\_local)}
\DoxyCodeLine{95   \{}
\DoxyCodeLine{96     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& library : \mbox{\hyperlink{classtesseract__common_1_1PluginLoader_ac21baef3ac5e035e5d6604c48dce293c}{search\_libraries}})}
\DoxyCodeLine{97     \{}
\DoxyCodeLine{98       \textcolor{keywordflow}{if} (\mbox{\hyperlink{structtesseract__common_1_1ClassLoader_a0bc9e092d94b12566d67e5a5ee0de337}{ClassLoader::isClassAvailable}}(plugin\_name, library, path))}
\DoxyCodeLine{99         \textcolor{keywordflow}{return} ClassLoader::createSharedInstance<PluginBase>(plugin\_name, library, path);}
\DoxyCodeLine{100     \}}
\DoxyCodeLine{101   \}}
\DoxyCodeLine{102 }
\DoxyCodeLine{103   \textcolor{comment}{// If not found in any of the provided search paths then search system folders if allowed}}
\DoxyCodeLine{104   \textcolor{keywordflow}{if} (\mbox{\hyperlink{classtesseract__common_1_1PluginLoader_aff0d53be8344f1875acd112f698cc117}{search\_system\_folders}})}
\DoxyCodeLine{105   \{}
\DoxyCodeLine{106     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& library : \mbox{\hyperlink{classtesseract__common_1_1PluginLoader_ac21baef3ac5e035e5d6604c48dce293c}{search\_libraries}})}
\DoxyCodeLine{107     \{}
\DoxyCodeLine{108       \textcolor{keywordflow}{if} (\mbox{\hyperlink{structtesseract__common_1_1ClassLoader_a0bc9e092d94b12566d67e5a5ee0de337}{ClassLoader::isClassAvailable}}(plugin\_name, library))}
\DoxyCodeLine{109         \textcolor{keywordflow}{return} ClassLoader::createSharedInstance<PluginBase>(plugin\_name, library);}
\DoxyCodeLine{110     \}}
\DoxyCodeLine{111   \}}
\DoxyCodeLine{112 }
\DoxyCodeLine{113   std::stringstream msg;}
\DoxyCodeLine{114   \textcolor{keywordflow}{if} (\mbox{\hyperlink{classtesseract__common_1_1PluginLoader_aff0d53be8344f1875acd112f698cc117}{search\_system\_folders}})}
\DoxyCodeLine{115     msg << std::endl << \textcolor{stringliteral}{"{}Search Paths (Search System Folders: True):"{}} << std::endl;}
\DoxyCodeLine{116   \textcolor{keywordflow}{else}}
\DoxyCodeLine{117     msg << std::endl << \textcolor{stringliteral}{"{}Search Paths (Search System Folders: False):"{}} << std::endl;}
\DoxyCodeLine{118 }
\DoxyCodeLine{119   \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& path : search\_paths\_local)}
\DoxyCodeLine{120     msg << \textcolor{stringliteral}{"{}    -\/ "{}} + path << std::endl;}
\DoxyCodeLine{121 }
\DoxyCodeLine{122   msg << \textcolor{stringliteral}{"{}Search Libraries:"{}} << std::endl;}
\DoxyCodeLine{123   \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& library : \mbox{\hyperlink{classtesseract__common_1_1PluginLoader_ac21baef3ac5e035e5d6604c48dce293c}{search\_libraries}})}
\DoxyCodeLine{124     msg << \textcolor{stringliteral}{"{}    -\/ "{}} + \mbox{\hyperlink{structtesseract__common_1_1ClassLoader_af2749622fe3be804a464ce5d5ea62ca9}{ClassLoader::decorate}}(library) << std::endl;}
\DoxyCodeLine{125 }
\DoxyCodeLine{126   CONSOLE\_BRIDGE\_logError(\textcolor{stringliteral}{"{}Failed to instantiate plugin '\%s', Details: \%s"{}}, plugin\_name.c\_str(), msg.str().c\_str());}
\DoxyCodeLine{127 }
\DoxyCodeLine{128   \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};}
\DoxyCodeLine{129 \}}
\DoxyCodeLine{130 }
\DoxyCodeLine{131 \textcolor{keywordtype}{bool} \mbox{\hyperlink{classtesseract__common_1_1PluginLoader_ae73347144bf79b795ed17959370f0559}{PluginLoader::isPluginAvailable}}(\textcolor{keyword}{const} std::string\& plugin\_name)\textcolor{keyword}{ const}}
\DoxyCodeLine{132 \textcolor{keyword}{}\{}
\DoxyCodeLine{133   \textcolor{comment}{// Check for environment variable for plugin definitions}}
\DoxyCodeLine{134   std::set<std::string> plugins\_local = \mbox{\hyperlink{namespacetesseract__common_a6649a8ac1b3dcd569656074bbcfce030}{getAllSearchLibraries}}(\mbox{\hyperlink{classtesseract__common_1_1PluginLoader_af3929c97ee7a2ca0865c616397c1caba}{search\_libraries\_env}}, \mbox{\hyperlink{classtesseract__common_1_1PluginLoader_ac21baef3ac5e035e5d6604c48dce293c}{search\_libraries}});}
\DoxyCodeLine{135   \textcolor{keywordflow}{if} (plugins\_local.empty())}
\DoxyCodeLine{136   \{}
\DoxyCodeLine{137     CONSOLE\_BRIDGE\_logError(\textcolor{stringliteral}{"{}No plugin libraries were provided!"{}});}
\DoxyCodeLine{138     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{139   \}}
\DoxyCodeLine{140 }
\DoxyCodeLine{141   \textcolor{comment}{// Check for environment variable to override default library}}
\DoxyCodeLine{142   std::set<std::string> search\_paths\_local = \mbox{\hyperlink{namespacetesseract__common_a4d07851ebdfbd06448599d1c188a2a50}{getAllSearchPaths}}(\mbox{\hyperlink{classtesseract__common_1_1PluginLoader_a07ad5f9ed665a443296650ba4cf74ac2}{search\_paths\_env}}, \mbox{\hyperlink{classtesseract__common_1_1PluginLoader_a0708204dd34adfdec1a7506df07cd30a}{search\_paths}});}
\DoxyCodeLine{143   \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& path : search\_paths\_local)}
\DoxyCodeLine{144   \{}
\DoxyCodeLine{145     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& library : \mbox{\hyperlink{classtesseract__common_1_1PluginLoader_ac21baef3ac5e035e5d6604c48dce293c}{search\_libraries}})}
\DoxyCodeLine{146     \{}
\DoxyCodeLine{147       \textcolor{keywordflow}{if} (\mbox{\hyperlink{structtesseract__common_1_1ClassLoader_a0bc9e092d94b12566d67e5a5ee0de337}{ClassLoader::isClassAvailable}}(plugin\_name, library, path))}
\DoxyCodeLine{148         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{149     \}}
\DoxyCodeLine{150   \}}
\DoxyCodeLine{151 }
\DoxyCodeLine{152   \textcolor{comment}{// If not found in any of the provided search paths then search system folders if allowed}}
\DoxyCodeLine{153   \textcolor{keywordflow}{if} (\mbox{\hyperlink{classtesseract__common_1_1PluginLoader_aff0d53be8344f1875acd112f698cc117}{search\_system\_folders}})}
\DoxyCodeLine{154   \{}
\DoxyCodeLine{155     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& library : \mbox{\hyperlink{classtesseract__common_1_1PluginLoader_ac21baef3ac5e035e5d6604c48dce293c}{search\_libraries}})}
\DoxyCodeLine{156     \{}
\DoxyCodeLine{157       \textcolor{keywordflow}{if} (\mbox{\hyperlink{structtesseract__common_1_1ClassLoader_a0bc9e092d94b12566d67e5a5ee0de337}{ClassLoader::isClassAvailable}}(plugin\_name, library))}
\DoxyCodeLine{158         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{159     \}}
\DoxyCodeLine{160   \}}
\DoxyCodeLine{161 }
\DoxyCodeLine{162   \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{163 \}}
\DoxyCodeLine{164 }
\DoxyCodeLine{165 \textcolor{keywordtype}{int} \mbox{\hyperlink{classtesseract__common_1_1PluginLoader_a8f0b1bf448293e184888f791baba0341}{PluginLoader::count}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{166 \textcolor{keyword}{}\{}
\DoxyCodeLine{167   \textcolor{keywordflow}{return} \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(\mbox{\hyperlink{namespacetesseract__common_a6649a8ac1b3dcd569656074bbcfce030}{getAllSearchLibraries}}(\mbox{\hyperlink{classtesseract__common_1_1PluginLoader_af3929c97ee7a2ca0865c616397c1caba}{search\_libraries\_env}}, \mbox{\hyperlink{classtesseract__common_1_1PluginLoader_ac21baef3ac5e035e5d6604c48dce293c}{search\_libraries}}).size());}
\DoxyCodeLine{168 \}}
\DoxyCodeLine{169 }
\DoxyCodeLine{170 \}  \textcolor{comment}{// namespace tesseract\_common}}
\DoxyCodeLine{171 }
\DoxyCodeLine{172 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// TESSERACT\_COMMON\_PLUGIN\_LOADER\_HPP}}

\end{DoxyCode}

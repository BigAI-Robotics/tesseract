\hypertarget{class__loader_8hpp_source}{}\doxysection{class\+\_\+loader.\+hpp}
\label{class__loader_8hpp_source}\index{tesseract\_common/include/tesseract\_common/class\_loader.hpp@{tesseract\_common/include/tesseract\_common/class\_loader.hpp}}
\mbox{\hyperlink{class__loader_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{26 \textcolor{preprocessor}{\#ifndef TESSERACT\_COMMON\_CLASS\_LOADER\_HPP}}
\DoxyCodeLine{27 \textcolor{preprocessor}{\#define TESSERACT\_COMMON\_CLASS\_LOADER\_HPP}}
\DoxyCodeLine{28 }
\DoxyCodeLine{29 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{macros_8h}{tesseract\_common/macros.h}}>}}
\DoxyCodeLine{30 \mbox{\hyperlink{macros_8h_a8cc0e3c6a3382c5c0b19eb9e676fc2db}{TESSERACT\_COMMON\_IGNORE\_WARNINGS\_PUSH}}}
\DoxyCodeLine{31 \textcolor{preprocessor}{\#include <boost/config.hpp>}}
\DoxyCodeLine{32 \textcolor{preprocessor}{\#include <boost/dll/import.hpp>}}
\DoxyCodeLine{33 \textcolor{preprocessor}{\#include <boost/dll/alias.hpp>}}
\DoxyCodeLine{34 \textcolor{preprocessor}{\#include <boost/dll/import\_class.hpp>}}
\DoxyCodeLine{35 \textcolor{preprocessor}{\#include <boost/dll/shared\_library.hpp>}}
\DoxyCodeLine{36 \textcolor{preprocessor}{\#include <console\_bridge/console.h>}}
\DoxyCodeLine{37 \mbox{\hyperlink{namespaceTESSERACT__COMMON__IGNORE__WARNINGS__POP}{TESSERACT\_COMMON\_IGNORE\_WARNINGS\_POP}}}
\DoxyCodeLine{38 }
\DoxyCodeLine{39 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{class__loader_8h}{tesseract\_common/class\_loader.h}}>}}
\DoxyCodeLine{40 }
\DoxyCodeLine{41 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacetesseract__common}{tesseract\_common}}}
\DoxyCodeLine{42 \{}
\DoxyCodeLine{43 \textcolor{keyword}{template} <\textcolor{keyword}{class} ClassBase>}
\DoxyCodeLine{44 std::shared\_ptr<ClassBase> \mbox{\hyperlink{structtesseract__common_1_1ClassLoader_ad1933611b2e5247267c29b146fb3054e}{ClassLoader::createSharedInstance}}(\textcolor{keyword}{const} std::string\& symbol\_name,}
\DoxyCodeLine{45                                                              \textcolor{keyword}{const} std::string\& library\_name,}
\DoxyCodeLine{46                                                              \textcolor{keyword}{const} std::string\& library\_directory)}
\DoxyCodeLine{47 \{}
\DoxyCodeLine{48   boost::system::error\_code ec;}
\DoxyCodeLine{49   boost::dll::shared\_library lib;}
\DoxyCodeLine{50   \textcolor{keywordflow}{if} (library\_directory.empty())}
\DoxyCodeLine{51   \{}
\DoxyCodeLine{52     boost::filesystem::path sl(library\_name);}
\DoxyCodeLine{53     boost::dll::load\_mode::type mode =}
\DoxyCodeLine{54         boost::dll::load\_mode::append\_decorations | boost::dll::load\_mode::search\_system\_folders;}
\DoxyCodeLine{55     lib = boost::dll::shared\_library(sl, ec, mode);}
\DoxyCodeLine{56   \}}
\DoxyCodeLine{57   \textcolor{keywordflow}{else}}
\DoxyCodeLine{58   \{}
\DoxyCodeLine{59     boost::filesystem::path sl = boost::filesystem::path(library\_directory) / library\_name;}
\DoxyCodeLine{60     lib = boost::dll::shared\_library(sl, ec, boost::dll::load\_mode::append\_decorations);}
\DoxyCodeLine{61   \}}
\DoxyCodeLine{62 }
\DoxyCodeLine{63   \textcolor{comment}{// Check if it failed to find or load library}}
\DoxyCodeLine{64   \textcolor{keywordflow}{if} (ec)}
\DoxyCodeLine{65     \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}Failed to find or load library: "{}} + \mbox{\hyperlink{structtesseract__common_1_1ClassLoader_af2749622fe3be804a464ce5d5ea62ca9}{decorate}}(library\_name, library\_directory) +}
\DoxyCodeLine{66                              \textcolor{stringliteral}{"{} with error: "{}} + ec.message());}
\DoxyCodeLine{67 }
\DoxyCodeLine{68   \textcolor{comment}{// Check if library has symbol}}
\DoxyCodeLine{69   \textcolor{keywordflow}{if} (!lib.has(symbol\_name))}
\DoxyCodeLine{70     \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}Failed to find symbol '"{}} + symbol\_name +}
\DoxyCodeLine{71                              \textcolor{stringliteral}{"{}' in library: "{}} + \mbox{\hyperlink{structtesseract__common_1_1ClassLoader_af2749622fe3be804a464ce5d5ea62ca9}{decorate}}(library\_name, library\_directory));}
\DoxyCodeLine{72 }
\DoxyCodeLine{73 \textcolor{preprocessor}{\#if BOOST\_VERSION >= 107600}}
\DoxyCodeLine{74   boost::shared\_ptr<ClassBase> plugin = boost::dll::import\_symbol<ClassBase>(lib, symbol\_name);}
\DoxyCodeLine{75 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{76   boost::shared\_ptr<ClassBase> plugin = boost::dll::import<ClassBase>(lib, symbol\_name);}
\DoxyCodeLine{77 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{78   \textcolor{keywordflow}{return} std::shared\_ptr<ClassBase>(plugin.get(), [plugin](ClassBase*) \textcolor{keyword}{mutable} \{ plugin.reset(); \});}
\DoxyCodeLine{79 \}}
\DoxyCodeLine{80 }
\DoxyCodeLine{81 \textcolor{keywordtype}{bool} \mbox{\hyperlink{structtesseract__common_1_1ClassLoader_a0bc9e092d94b12566d67e5a5ee0de337}{ClassLoader::isClassAvailable}}(\textcolor{keyword}{const} std::string\& symbol\_name,}
\DoxyCodeLine{82                                    \textcolor{keyword}{const} std::string\& library\_name,}
\DoxyCodeLine{83                                    \textcolor{keyword}{const} std::string\& library\_directory)}
\DoxyCodeLine{84 \{}
\DoxyCodeLine{85   boost::system::error\_code ec;}
\DoxyCodeLine{86   boost::dll::shared\_library lib;}
\DoxyCodeLine{87   \textcolor{keywordflow}{if} (library\_directory.empty())}
\DoxyCodeLine{88   \{}
\DoxyCodeLine{89     boost::filesystem::path sl(library\_name);}
\DoxyCodeLine{90     boost::dll::load\_mode::type mode =}
\DoxyCodeLine{91         boost::dll::load\_mode::append\_decorations | boost::dll::load\_mode::search\_system\_folders;}
\DoxyCodeLine{92     lib = boost::dll::shared\_library(sl, ec, mode);}
\DoxyCodeLine{93   \}}
\DoxyCodeLine{94   \textcolor{keywordflow}{else}}
\DoxyCodeLine{95   \{}
\DoxyCodeLine{96     boost::filesystem::path sl = boost::filesystem::path(library\_directory) / library\_name;}
\DoxyCodeLine{97     lib = boost::dll::shared\_library(sl, ec, boost::dll::load\_mode::append\_decorations);}
\DoxyCodeLine{98   \}}
\DoxyCodeLine{99 }
\DoxyCodeLine{100   \textcolor{comment}{// Check if it failed to find or load library}}
\DoxyCodeLine{101   \textcolor{keywordflow}{if} (ec)}
\DoxyCodeLine{102   \{}
\DoxyCodeLine{103     CONSOLE\_BRIDGE\_logDebug(\textcolor{stringliteral}{"{}Failed to find or load library: \%s with error: \%s"{}},}
\DoxyCodeLine{104                             \mbox{\hyperlink{structtesseract__common_1_1ClassLoader_af2749622fe3be804a464ce5d5ea62ca9}{decorate}}(library\_name, library\_directory).c\_str(),}
\DoxyCodeLine{105                             ec.message().c\_str());}
\DoxyCodeLine{106     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{107   \}}
\DoxyCodeLine{108 }
\DoxyCodeLine{109   \textcolor{keywordflow}{return} lib.has(symbol\_name);}
\DoxyCodeLine{110 \}}
\DoxyCodeLine{111 }
\DoxyCodeLine{112 std::string \mbox{\hyperlink{structtesseract__common_1_1ClassLoader_af2749622fe3be804a464ce5d5ea62ca9}{ClassLoader::decorate}}(\textcolor{keyword}{const} std::string\& library\_name, \textcolor{keyword}{const} std::string\& library\_directory)}
\DoxyCodeLine{113 \{}
\DoxyCodeLine{114   boost::filesystem::path sl;}
\DoxyCodeLine{115   \textcolor{keywordflow}{if} (library\_directory.empty())}
\DoxyCodeLine{116     sl = boost::filesystem::path(library\_name);}
\DoxyCodeLine{117   \textcolor{keywordflow}{else}}
\DoxyCodeLine{118     sl = boost::filesystem::path(library\_directory) / library\_name;}
\DoxyCodeLine{119 }
\DoxyCodeLine{120   boost::filesystem::path actual\_path =}
\DoxyCodeLine{121       (std::strncmp(sl.filename().string().c\_str(), \textcolor{stringliteral}{"{}lib"{}}, 3) != 0 ?}
\DoxyCodeLine{122            boost::filesystem::path((sl.has\_parent\_path() ? sl.parent\_path() / L\textcolor{stringliteral}{"{}lib"{}} : L\textcolor{stringliteral}{"{}lib"{}}).native() +}
\DoxyCodeLine{123                                    sl.filename().native()) :}
\DoxyCodeLine{124            sl);}
\DoxyCodeLine{125 }
\DoxyCodeLine{126   actual\_path += boost::dll::shared\_library::suffix();}
\DoxyCodeLine{127   \textcolor{keywordflow}{return} actual\_path.string();}
\DoxyCodeLine{128 \}}
\DoxyCodeLine{129 }
\DoxyCodeLine{130 \}  \textcolor{comment}{// namespace tesseract\_common}}
\DoxyCodeLine{131 }
\DoxyCodeLine{132 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// TESSERACT\_COMMON\_CLASS\_LOADER\_HPP}}

\end{DoxyCode}
